<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>bl67st</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&display=swap" rel="stylesheet">
<style>
body {
    background:#111;
    color:white;
    font-family:'Poppins', sans-serif;
    text-align:center;
    overflow-x:hidden;
}
h1#logo {
    font-size:60px;
    margin-top:50px;
    font-weight:800;
    background: linear-gradient(90deg,#00c3ff,#ffb400);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    opacity:0;
    transform:translateY(-50px);
    animation: logoEnter 1s ease forwards;
}
@keyframes logoEnter {
    to { opacity:1; transform:translateY(0); }
}

/* Board */
#board {
    display:grid;
    grid-template-columns:repeat(8,40px);
    gap:4px;
    justify-content:center;
    margin:20px auto;
}
.cell {
    width:40px;
    height:40px;
    background:#222;
    border-radius:5px;
    transition: background 0.2s ease;
}
.cell.filled {
    background:#00c3ff;
    animation: fadeIn 0.15s ease;
}
.cell.clearing {
    animation: fadeOut 0.2s ease forwards;
}
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
@keyframes fadeOut { from {opacity:1;} to {opacity:0;} }

/* Blocks */
#blocks {
    display:flex;
    justify-content:center;
    gap:20px;
    margin-top:15px;
}
.block {
    display:grid;
    gap:2px;
    grid-auto-rows:18px;
    grid-auto-flow:row;
    padding:6px;
    cursor:pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
}
.block:hover { transform:scale(1.05); box-shadow:0 0 8px #00c3ff; }
.block div {
    width:18px;
    height:18px;
    background:orange;
    border-radius:4px;
}
.block .empty { visibility:hidden; }
.selected { outline:3px solid yellow; }

/* Game Over */
#gameover {
    display:none;
    margin-top:20px;
    font-size:36px;
    font-weight:800;
    background: linear-gradient(90deg,#ff3cac,#00c3ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    opacity:0;
    transform:scale(0.8);
}
#gameover.show {
    display:block;
    animation: gameOverEnter 0.5s ease forwards;
}
@keyframes gameOverEnter {
    to { opacity:1; transform:scale(1); }
}

/* Buttons */
button {
    padding:10px 20px;
    font-size:18px;
    cursor:pointer;
    border:none;
    border-radius:8px;
    background:#00c3ff;
    color:#111;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    font-weight:600;
}
button:hover {
    transform:translateY(-3px) scale(1.05);
    box-shadow:0 0 12px #00c3ff;
    background:#00e0ff;
}
button:active {
    transform:scale(0.95);
    box-shadow:0 0 6px #00c3ff;
}

/* Hide default audio controls */
audio { display:none; }
</style>
</head>
<body>

<h1 id="logo">ðŸ§© bl67st</h1>
Score: <span id="score">0</span>

<div id="board"></div>
<div id="blocks"></div>

<div id="gameover">
    ðŸ’€ GAME OVER<br><br>
    <button onclick="restart()">ChÆ¡i láº¡i</button>
</div>

<!-- Audio -->
<audio id="bgm" src="bgm.mp3" loop></audio>
<audio id="place" src="place.wav"></audio>
<audio id="clear" src="clear.mp3"></audio>

<script>
const size=8;
let board = Array(size*size).fill(0);
let score=0;
let selectedBlock=null;
let currentBlocks=[];

const boardDiv=document.getElementById("board");
const blocksDiv=document.getElementById("blocks");
const scoreSpan=document.getElementById("score");
const gameOverDiv=document.getElementById("gameover");
const bgmAudio=document.getElementById("bgm");
const soundPlace=document.getElementById("place");
const soundClear=document.getElementById("clear");

// autoplay bgm after first click
document.body.addEventListener("click",function playBgmOnce(){
    bgmAudio.play().catch(()=>{});
    document.body.removeEventListener("click",playBgmOnce);
});

// Shapes
const shapes=[
    [[1,1,1]],
    [[1],[1],[1]],
    [[1,1],[1,1]],
    [[1,1,1],[0,1,0]],
    [[1,1]],
    [[1,1,1,1]]
];

// ===== INIT BOARD =====
function initBoard(){
    board.fill(0);
    boardDiv.innerHTML="";
    for(let i=0;i<size*size;i++){
        const c=document.createElement("div");
        c.className="cell";
        c.onclick=()=>placeBlock(i);
        boardDiv.appendChild(c);
    }
}

// ===== RENDER BOARD =====
function renderBoard(){
    document.querySelectorAll(".cell").forEach((c,i)=>{
        c.className="cell";
        if(board[i]) c.classList.add("filled");
    });
}

// ===== RANDOM BLOCKS =====
function randomBlocks(){
    blocksDiv.innerHTML="";
    selectedBlock=null;
    currentBlocks=[];
    for(let i=0;i<3;i++){
        const shape=shapes[Math.floor(Math.random()*shapes.length)];
        currentBlocks.push(shape);
        const b=document.createElement("div");
        b.className="block";
        b.style.gridTemplateColumns=`repeat(${shape[0].length},18px)`;
        shape.forEach(row=>row.forEach(v=>{
            const d=document.createElement("div");
            if(!v) d.classList.add("empty");
            b.appendChild(d);
        }));
        b.onclick=()=>{
            document.querySelectorAll(".block").forEach(x=>x.classList.remove("selected"));
            b.classList.add("selected");
            selectedBlock=shape;
        };
        blocksDiv.appendChild(b);
    }
    if(checkGameOver()) endGame();
}

// ===== PLACE BLOCK =====
function placeBlock(index){
    if(!selectedBlock) return;
    const x=index%size;
    const y=Math.floor(index/size);
    for(let r=0;r<selectedBlock.length;r++)
        for(let c=0;c<selectedBlock[0].length;c++)
            if(selectedBlock[r][c]){
                const nx=x+c, ny=y+r;
                if(nx>=size||ny>=size||board[ny*size+nx]) return;
            }
    for(let r=0;r<selectedBlock.length;r++)
        for(let c=0;c<selectedBlock[0].length;c++)
            if(selectedBlock[r][c]) board[(y+r)*size+(x+c)]=1;

    soundPlace.currentTime=0; soundPlace.play();

    score+=5;
    clearLines();
    scoreSpan.innerText=score;
    renderBoard();
    randomBlocks();
}

// ===== CLEAR LINES =====
function clearLines(){
    let toClear=[];
    for(let r=0;r<size;r++){
        let full=true;
        for(let c=0;c<size;c++) if(!board[r*size+c]) full=false;
        if(full) for(let c=0;c<size;c++) toClear.push(r*size+c);
    }
    for(let c=0;c<size;c++){
        let full=true;
        for(let r=0;r<size;r++) if(!board[r*size+c]) full=false;
        if(full) for(let r=0;r<size;r++) toClear.push(r*size+c);
    }
    if(!toClear.length) return;
    soundClear.currentTime=0; soundClear.play();
    toClear.forEach(idx=> boardDiv.children[idx].classList.add("clearing"));
    setTimeout(()=>{
        toClear.forEach(idx=>{
            board[idx]=0;
            boardDiv.children[idx].classList.remove("clearing");
        });
        renderBoard();
    },200);
}

// ===== GAME OVER =====
function canPlace(shape){
    for(let i=0;i<size*size;i++){
        const x=i%size, y=Math.floor(i/size);
        let ok=true;
        shape.forEach((r,ry)=>r.forEach((v,rx)=>{
            if(v&&(x+rx>=size||y+ry>=size||board[(y+ry)*size+(x+rx)])) ok=false;
        }));
        if(ok) return true;
    }
    return false;
}
function checkGameOver(){
    return currentBlocks.every(b=>!canPlace(b));
}
function endGame(){
    gameOverDiv.classList.add("show");
    bgmAudio.pause();
}
function restart(){
    score=0;
    scoreSpan.innerText=score;
    gameOverDiv.classList.remove("show");
    initBoard();
    renderBoard();
    randomBlocks();
    bgmAudio.currentTime=0;
    bgmAudio.play().catch(()=>{});
}

// ===== START =====
initBoard();
renderBoard();
randomBlocks();
</script>

</body>
</html>
